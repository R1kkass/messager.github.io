"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[324],{3324:function(e,n,t){t.r(n),t.d(n,{default:function(){return j}});var i=t(9439),s=t(2791),r=t(7689),o=t(9348),c=t(9434),l=t(2905),d=t(184),a=(0,s.memo)((function(e){var n=e.mesg,t=e.deleteMessage,i=((0,s.useRef)(null),(0,c.v9)((function(e){return e.auth.auth})),(0,c.v9)((function(e){return e.auth.firebase})),(0,c.v9)((function(e){return e.token.token})));return(0,d.jsx)(d.Fragment,{children:null===n||void 0===n?void 0:n.map((function(e){return(0,d.jsx)("div",{children:"connection"==e.event?(0,d.jsxs)("div",{children:[e.user," \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u043b\u0441\u044f \u043a \u0447\u0430\u0442\u0443"]}):(0,d.jsxs)("div",{className:e.user==(null===i||void 0===i?void 0:i.email)?"Websocket__messageYou":"Websocket__message",children:[(0,d.jsxs)("p",{children:["\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u0435\u043b\u044c: ",e.user]}),(0,d.jsx)("p",{children:e.text}),e.user==(null===i||void 0===i?void 0:i.email)?(0,d.jsx)("button",{onClick:function(){return t(e.id)},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"}):"",(0,d.jsx)("img",{className:"Websocket__img",src:"http://".concat(l.o6,"/").concat(null===e||void 0===e?void 0:e.user,".jpg"),alt:null===e||void 0===e?void 0:e.user})]})},e.id)}))})})),u=function(e){var n=e.visible;return(0,d.jsx)(d.Fragment,{children:n?(0,d.jsx)("div",{className:"lds-ring",children:(0,d.jsxs)("div",{className:"nado",children:[(0,d.jsx)("div",{className:"lds-rings"}),(0,d.jsx)("div",{className:"lds-rings"}),(0,d.jsx)("div",{className:"lds-rings"}),(0,d.jsx)("div",{className:"lds-rings"})]})}):""})},v=t(456),m=t(780),h=t(1087),f=(0,s.memo)((function(){var e,n,t,i,o,a=(0,c.v9)((function(e){return e.chat.chats})),u=(0,c.v9)((function(e){return e.token.token})),v=(0,r.UO)(),m=(0,s.useMemo)((function(){var e,n;return null===a||void 0===a||null===(e=a.data)||void 0===e||null===(n=e.user)||void 0===n?void 0:n.filter((function(e){return(null===v||void 0===v?void 0:v.id)==(null===e||void 0===e?void 0:e.idRoom)}))}),[a]);return(0,d.jsx)(d.Fragment,{children:(0,d.jsx)("div",{className:"Websocket__chatTop",children:(0,d.jsx)("div",{children:m?(null===(e=m[0])||void 0===e?void 0:e.secondUser)!==(null===u||void 0===u?void 0:u.email)?(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)(h.rU,{to:"/my/".concat(m[0].secondUserId),children:[(0,d.jsx)("img",{src:"http://".concat(l.o6,"/").concat(null===(n=m[0])||void 0===n?void 0:n.secondUser,".jpg"),alt:""}),null===(t=m[0])||void 0===t?void 0:t.secondUser]})}):(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)(h.rU,{to:"/my/".concat(m[0].userCreatorId),children:[(0,d.jsx)("img",{src:"http://".concat(l.o6,"/").concat(null===(i=m[0])||void 0===i?void 0:i.userCreator,".jpg"),alt:""}),null===(o=m[0])||void 0===o?void 0:o.userCreator]})}):""})})})})),x=0,j=(0,s.memo)((function(){var e=(0,c.I0)(),n=(0,s.useRef)(null),t=(0,s.useState)(!1),l=(0,i.Z)(t,2),h=(l[0],l[1]),j=(0,r.UO)(),g=((0,s.useRef)(null),(0,s.useState)("")),k=(0,i.Z)(g,2),N=(k[0],k[1]),b=(0,s.useState)(""),p=(0,i.Z)(b,2),S=(p[0],p[1],(0,c.v9)((function(e){return e.token.token}))),_=localStorage.getItem("token")?(0,v.Z)(localStorage.getItem("token")||""):"",y=(0,o.YD)({threshold:0}),w=y.ref,U=y.inView;y.entry;(0,s.useEffect)((function(){x+=10,U&&Number(O)>x&&function(){var e,t={event:"limit",limit:x,id:j.id};null===(e=n.current)||void 0===e||e.send(JSON.stringify(t))}()}),[U]);var W=(0,s.useRef)(),C=(0,c.v9)((function(e){return e.messages.messages})),O=(0,c.v9)((function(e){return e.messages.count})),I={weekday:"short",year:"numeric",month:"long",day:"numeric"};(0,c.v9)((function(e){return e.chat.chats}));(0,s.useEffect)((function(){n.current=new WebSocket("ws://localhost:5001/con"),n.current.onopen=function(){var e,t={event:"connection",username:null===_||void 0===_?void 0:_.email,id:j.id,limit:x};null===(e=n.current)||void 0===e||e.send(JSON.stringify(t)),h(!0),setInterval((function(){}),15e3)},n.current.onmessage=function(n){var t=JSON.parse(n.data);e({type:"SEND",action:t.rows}),e({type:"COUNT",action:t.count}),F(!1)},n.current.onerror=function(){h(!1),N("\u041d\u0435\u0442 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f")},n.current.close=function(){console.log("\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u043e")}}),[]);var R=(0,s.useState)(!1),D=(0,i.Z)(R,2),Z=D[0],F=D[1];return null==localStorage.getItem("token")?(0,d.jsx)("div",{children:(0,d.jsx)("h2",{children:"\u0412\u044b \u043d\u0435 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u043d\u044b"})}):(0,d.jsxs)("div",{className:"Websocket__grid",children:[(0,d.jsx)(u,{visible:Z}),(0,d.jsx)(m.Z,{}),(0,d.jsx)("div",{className:"Websocket",children:(0,d.jsxs)("div",{children:[(0,d.jsx)("br",{}),(0,d.jsx)(f,{}),(0,d.jsx)("div",{className:"Websocket__textarea",children:(0,d.jsxs)("div",{children:[(0,d.jsx)("textarea",{ref:W,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435"}),(0,d.jsx)("br",{}),(0,d.jsx)("button",{onClick:function(){var e,t;F(!0);var i={event:"message",limit:x,text:(null===(e=W.current)||void 0===e?void 0:e.value)||"",username:S.email,date:(new Date).toLocaleDateString("RU",I)+" "+(new Date).toLocaleTimeString(),id:j.id};null===(t=n.current)||void 0===t||t.send(JSON.stringify(i)),window.scrollTo({top:0,left:0,behavior:"smooth"}),W.current.value=""},children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"})]})}),(0,d.jsx)("div",{className:"Websocket__conteiner",children:(0,d.jsx)(a,{deleteMessage:function(e){var t;F(!0);var i={event:"delete",limit:x,id:j.id,idDelete:e,idRoom:j.id,username:S.email};null===(t=n.current)||void 0===t||t.send(JSON.stringify(i))},mesg:C})}),(0,d.jsx)("div",{ref:w,children:(0,d.jsx)("h2",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430..."})})]})})]})}))}}]);
//# sourceMappingURL=324.8d98d3c9.chunk.js.map